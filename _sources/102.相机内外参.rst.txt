102.相机内外参
################################


一、相机内参（Intrinsic Parameters）：描述相机“自身属性”
相机内参仅与相机硬件结构相关，**不随相机在空间中的位置/姿态变化**，一旦相机制造完成或标定后便固定（除非调整焦距、光圈等硬件参数）。其核心作用是建立“相机坐标系”（以相机光心为原点的三维坐标系）到“图像坐标系”（图像像素平面的二维坐标系）的映射关系。

1. 内参的核心参数与作用
内参通常用一个 3×3 的矩阵 \( K \) 表示，包含5个关键参数（针孔相机模型下），各参数作用如下：

参数符号
参数名称
物理意义与核心作用
\( f_x \)
水平方向焦距（像素单位）
将相机坐标系中“水平方向的三维距离”转换为图像平面“水平方向的像素距离”，与物理焦距 \( f \) 和传感器水平像素尺寸 \( d_x \) 满足 \( f_x = f / d_x \)。
\( f_y \)
垂直方向焦距（像素单位）
同理，将“垂直方向的三维距离”转换为“垂直方向的像素距离”，满足 \( f_y = f / d_y \)（\( d_y \) 为传感器垂直像素尺寸）。
\( c_x \)
主点水平坐标（像素）
相机**光轴**（镜头中心轴线）与图像平面的交点（即“主点”）的水平像素坐标，通常接近图像中心，但因制造误差可能偏移。
\( c_y \)
主点垂直坐标（像素）
主点的垂直像素坐标，作用同上，确保光轴投影位置准确。
\( s \)
skew 因子（倾斜系数）
描述图像坐标系水平轴与垂直轴的非正交程度（因传感器安装偏差导致），多数相机 \( s=0 \)，作用是修正轴倾斜带来的投影偏差。

2. 内参的核心功能总结
- 尺度转换：将物理世界的“毫米/米”等单位，转换为图像的“像素”单位（通过 \( f_x, f_y \) 实现）；
- 定位主点：确定光轴在图像上的投影位置（\( c_x, c_y \)），避免因主点偏移导致的图像“偏移”误差；
- 修正畸变：配合畸变参数（如径向畸变、切向畸变，常与内参一同标定），修正镜头光学缺陷导致的图像变形（如鱼眼镜头的桶形畸变、长焦镜头的枕形畸变）。
二、相机外参（Extrinsic Parameters）：描述相机“空间姿态”
相机外参与相机在**真实世界坐标系（世界坐标系）中的位置和姿态相关**，会随相机移动、旋转而实时变化。其核心作用是建立“世界坐标系”（如地面、机器人基座的三维坐标系）到“相机坐标系”的转换关系，即回答“相机在世界的哪里？”“相机朝向哪个方向？”。

1. 外参的核心参数与作用
外参由两部分组成，共同实现世界坐标系到相机坐标系的“刚体变换”（仅位置和姿态变化，不改变尺度）：

参数类型
参数名称
物理意义与核心作用
旋转矩阵 \( R \)（3×3）
姿态参数
描述相机坐标系相对于世界坐标系的**旋转角度**，包含3个自由度（绕X轴俯仰、绕Y轴偏航、绕Z轴滚转）。通过 \( R \) 可将世界坐标系中的向量“旋转”到相机坐标系中。
平移向量 \( t \)（3×1）
位置参数
描述相机坐标系原点相对于世界坐标系原点的**位置偏移**，包含3个自由度（X/Y/Z轴方向的距离）。通过 \( t \) 可将世界坐标系中的点“平移”到相机坐标系中。

2. 外参的核心功能总结
- 姿态定位：确定相机的朝向（如机器人视觉中“相机是否对准目标”）；
- 位置定位：确定相机在世界中的位置（如无人机航拍中“相机当前的GPS坐标对应图像哪个区域”）；
- 坐标转换：将真实场景中物体的世界坐标（如“桌子左上角在世界坐标系中坐标为 (1,2,0) ”）转换为相机坐标系下的坐标，为后续投影到图像平面做准备。
三、内参与外参的协同作用：完整投影流程
内参和外参并非独立工作，而是通过“三维点→相机坐标系→二维图像点”的两步投影流程协同作用，最终实现“真实场景成像”：

1. 第一步：世界坐标 → 相机坐标（外参作用）设世界坐标系中的三维点为 $$P_w = [X_w, Y_w, Z_w]^T $$，通过外参的刚体变换，得到该点在相机坐标系中的坐标  $$P_c = [X_c, Y_c, Z_c]^T$$ ，公式为：$$ P_c = R \cdot P_w + t $$（本质是先旋转对齐坐标系，再平移原点）
2. 第二步：相机坐标 → 图像坐标（内参作用）通过针孔相机模型，将相机坐标系中的三维点 $$P_c$$ 投影到图像平面的二维像素坐标 $$p = [u, v]^T $$，公式为：$$ \begin{bmatrix} u \\ v \\ 1 \end{bmatrix} = \frac{1}{Z_c} \cdot K \cdot \begin{bmatrix} X_c \\ Y_c \\ Z_c \end{bmatrix} $$$$( 1/Z_c )$$ 是“透视投影”的核心，体现“远小近大”的成像规律；内参$$K$$ 负责将相机坐标的物理单位转换为像素单位，并修正主点偏移）
[图片]
四、典型应用场景：为何需要内参和外参？
内参和外参的标定与应用是计算机视觉的基础，常见场景包括：

应用领域
内参的作用
外参的作用
三维重建
修正镜头畸变，确保重建的三维模型无变形；提供像素与物理尺度的映射（如“100像素对应真实世界10厘米”）。
确定多个相机（或同一相机不同位置）的相对姿态和位置，实现多视角图像融合（如立体视觉的双目相机外参标定）。
目标测量
结合内参计算目标的真实尺寸（如“图像中目标占200像素，已知内参可反推其真实宽度”）。
确定目标在世界坐标系中的位置（如“通过外参计算图像中汽车的真实GPS坐标”）。
相机标定
出厂或使用前标定内参，消除硬件误差（如焦距偏移、主点偏移）。
标定多相机间的相对外参（如双目相机、全景相机），确保各相机图像可对齐。
SLAM（同步定位与地图构建）
提供相机的固有参数，作为定位和建图的“基准”。
实时估计相机（如机器人、AR设备）的位置和姿态，实现“边走边建图”。
AR/VR
修正虚拟物体渲染时的畸变，确保虚拟图像与真实图像融合自然。
实时跟踪相机（如手机、VR头显）的姿态和位置，让虚拟物体“固定”在真实场景中（如AR中“虚拟杯子放在真实桌子上”）。


总结：内参与外参的核心区别与联系
维度
内参（Intrinsic）
外参（Extrinsic）
决定因素
相机硬件（镜头、传感器）
相机在世界中的位置和姿态
稳定性
固定（除非调整焦距、硬件）
动态变化（随相机移动/旋转）
核心作用
连接相机坐标系与图像坐标系（像素映射）
连接世界坐标系与相机坐标系（空间定位）
依赖关系
不依赖外参
不依赖内参，但需与内参协同完成投影